<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.main.careerbro.modules.attention.dao.AttentionDao">

    <sql id="attentionColumns">
        a.id as id,
        a.user_id as userId,
        u.cname as user,
        a.attention_id as attentionId,
        c.cname as attend
    </sql>

    <sql id="attentionJoins">
        JOIN user u ON u.id = a.user_id
        JOIN corperation c ON c.id = a.attention_id
--         JOIN job j ON j.id = a.attention_id
    </sql>

    <!--关注的公司:1,关注的岗位:2-->
    <select id="getAllAttention" resultType="com.main.careerbro.modules.attention.entity.Attention">
        SELECT
        <include refid="attentionColumns"/>
        FROM user_attention a
        WHERE a.user_id = #{uid}
        AND  a.category = #{category}
        AND a.validity = 1
        ORDER BY a.ftime
    </select>

    <insert id="saveAttention">
        INSERT INTO user_attention(
        id,
        user_id,
        attention_id,
        category,
        ftime,
        validity
        )VALUES (
        #{id},
        #{userId},
        #{attendId},
        #{category},
        NOW(),
        1
        )
    </insert>

    <update id="cancelAttend">
        UPDATE user_attention
        SET validity = -1
        WHERE id = #{id}
    </update>

</mapper>